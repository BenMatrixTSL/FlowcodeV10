<!DOCTYPE html>
<html>
<head>
<title>Blank Web - created by Flowcode V10.0</title>

<!----------------------------------------------------------------------------------

Source name:   D:\Dev\Flowcode V10\Components\examples\Web_JSON_Decoder.fcsx
Title:         Blank Web
Description:   A blank Web App Developer project suitable for creating apps that run in a browser
Device:        Web Export

Generated by:  Flowcode v10.0.4.36
Date:          Monday, November 27, 2023 17:02:13
Users:         10
Registered to: BenR (BenR)
Licence key: C9TN1M


   NOT FOR COMMERCIAL USE

https://www.flowcode.co.uk

<---------------------------------------------------------------------------------->



<!-- WEBEXP: add any includes, etc, at the start of the file here-->
      <script>
    function sin(a)                 { return Math.sin(a); }
    function cos(a)                 { return Math.cos(a); }
    function tan(a)                 { return Math.tan(a); }
    function asin(a)                { return Math.asin(a); }
    function acos(a)                { return Math.acos(a); }
    function atan(a)                { return Math.atan(a); }
    function atan2(y,x)             { return Math.atan2(y,x); }
    function sinh(a)                { return Math.sinh(a); }
    function cosh(a)                { return Math.cosh(a); }
    function tanh(a)                { return Math.tanh(a); }
    function asinh(a)               { return Math.asinh(a); }
    function acosh(a)               { return Math.acosh(a); }
    function atanh(a)               { return Math.atanh(a); }
    function fact(a)                { TODO; }
    function log(a)                 { return Math.log(a); }
    function log10(a)               { return Math.log10(a); }
    function float32_sqrt(a)        { return Math.sqrt(a); }  //same as float32_sqrt
    function sqrt(a)                { return Math.sqrt(a); }
    function cbrt(a)                { return Math.cbrt(a); }
    function exp(a)                 { return Math.exp(a); }
    function flt_rem(a)             { TODO; }
    function fmod(a)                { TODO; }  //same as flt_rem
    function fabs(a)                { return Math.abs(a); }
    function rand(a)                { return Math.round(65535 * Math.random(a)); }
    function random(a)              { return Math.round(65535 * Math.random(a)); }  //same as rand
    function fround(a)              { return Math.round(a); }
    function pow(x,y)               { return Math.pow(x,y); }
    function ceil(a)                { return Math.ceil(a); }
    function floor(a)               { return Math.floor(a); }
    function round(a)               { return Math.round(a); }
    function flt_add(a,b)           { return (a+b); }
    function flt_sub(a,b)           { return (a-b); }
    function flt_mul(a,b)           { return (a*b); }
    function flt_div(a,b)           { return (a/b); }
    function flt_le(a,b)            { return (a <= b); }
    function flt_lt(a,b)            { return (a < b); }
    function flt_eq(a,b)            { return (a == b); }
    function flt_ge(a,b)            { return (a >= b); }
    function flt_gt(a,b)            { return (a > b); }
    function flt_toi(a)             { return Math.round(a); }
    function flt_fromi(a)           { return (a); }
    function FCI_ARRAYDIMS(a)       { return (a); }
    function FCI_ARRAYSIZE(a)       { return (a); }

    function FCI_GETCHAR(a,b)       { return a.charCodeAt(b); }
    function FCI_GETLENGTH(a)       { return a.length; }
    function FCI_GETUTF8LEN(a)      { return a.length; }
    function FCI_LEFTSTRING(a,b)    { return a.slice(0,b); }
    function FCI_RIGHTSTRING(a,b)   { return a.slice(0-b); }
    function FCI_MIDSTRING(a,b,c)   { return a.slice(b,b+c); }
    function FCI_TOUPPER(a)         { return a.toUpperCase(); }
    function FCI_TOLOWER(a)         { return a.toLowerCase(); }
    
    function FCI_STRING_TO_INT(a)   { return parseInt(a); }
    function FCI_STRING_TO_FLOAT(a) { return parseFloat(a); }
    function FCI_TOSTRING(a)        { return a.toString(10); }
    function FCI_FLOAT2STR(a)       { return a.toString(); }
    function FCI_FLOAT2STR(a,b)     { return a.toPrecision(b).toString(); }
    function FCI_NUMBER_TO_HEX(a)   { return "0x" + a.toString(16); }
    
    function FCI_COMPARE(a,b,c)
    {
      if (c)
      {
        if (a.toUpperCase() == b.toUpperCase())
          return 0;
        else
          if (a.toUpperCase() > b.toUpperCase())
            return 1;
          else
            return -1;
      } else {
        if (a == b)
          return 0;
        else
          if (a > b)
            return 1;
          else
            return -1;
      }
    }

    function FCI_CONTAINS(a,b,c)    { return a.indexOf(b,c); }
    function FCI_SPLITSTRING(a,b,c) { const SSarray = a.split(b); return SSarray[c]; }
    
    function FCI_EXPLODETOINTARRAY(a,b,c)        { return a.split(b).map(Number); }
    function FCI_EXPLODETOFLOATARRAY(a,b,c)      { return a.split(b).map(Number); }
    function FCI_IMPLODEFROMINTARRAY(a,b,c)    	 { let sRetval = ""; for (i=0;i<c;i++) {sRetval = sRetval + a[i].toString(10); if(i<(c - 1)) {sRetval = sRetval + b;} } return sRetval; }
    function FCI_IMPLODEFROMFLOATARRAY(a,b,c,d)  { let sRetval = ""; for (i=0;i<c;i++) {sRetval = sRetval + a[i].toPrecision(d).toString(); if(i<(c - 1)) {sRetval = sRetval + b;} } return sRetval; }
    function FCI_INTTOFORMATTEDSTRING(a,b,c)     { TODO ; }
    function FCI_FLOATTOFORMATTEDSTRING(a,b,c)   { TODO ; }
    function FCI_INSERTSTRING(a,b,c)             { return a.slice(0,c)+b+a.slice(c); }
    function FCI_REMOVEFROMSTRING(a,b,c)         { return a.slice(0,b)+a.slice(b+c); }
    function FCI_SEARCHANDREPLACE(a,b,c)         { let count = a.split(b).length-1; a.replace(b,c); return count;}
   
    
    function resolveAfterMs(val)          { return new Promise((resolve) => { setTimeout(() => { resolve("milli"); }, val); }); }
    async function FCI_DELAYBYTE_US(a)    { await resolveAfterMs(a/1000); }
    async function FCI_DELAYBYTE_MS(a)    { await resolveAfterMs(a); }
    async function FCI_DELAYBYTE_S(a)     { await resolveAfterMs(1000*a); }
    async function FCI_DELAYINT_US(a)     { await resolveAfterMs(a/1000); }
    async function FCI_DELAYINT_MS(a)     { await resolveAfterMs(a); }
    async function FCI_DELAYINT_S(a)      { await resolveAfterMs(1000*a); }

    const MxDelayedObjects = [ ];

   </script>


<!--Script headers for components-->
<script>
//Script header for <08a81_JSONDecoder1>
  function FCMACREV_08a81_JSONDecoder1(key, value)
  {
    return value;
  }


//Script header for <00011_WebDevLibraryComponent1>


//Script header for <052d1_TextBlock1>
</script>
<style>
.obj052d1_TextBlock1 {
  font-size: 12px;
  text-align: left;
  font-family: Arial, sans-serif;
  background-color: transparent;
  color: #000000;
  word-wrap: break-word;
  /*width:inherit;
  height:inherit;/*
}
</style>
<script>


</script>

</head>



<body style='background-color:#f5f5f5;'>

<!--HTML body info for components-->
<div class = 'container minheight'>


  <div style='position: absolute; left: 130px; top: 30px; width: 400px; height: 90px; white-space: normal; overflow: visible;'>
    <div id='052d1_TextBlock1' class='obj052d1_TextBlock1'>Temperature: 0
    <br>Humidity: 0
    </div>
  </div>
</div>

<script>
  //NOTE: we can add fixed functions here from within the Flowcode exe if we want.
  function FCAPI_GetHtmlElement(id) { return document.getElementById(id); }
</script>

<script>

/*=----------------------------------------------------------------------=*\
   Use :TextBlock1
       :GUID: 3bd55a33-d9ed-44a0-80d9-76a8d954a335
       :Location: D:\Dev\Flowcode V10\Components\temprelease\WebTextBlock.fcpx
       :Version: 1.0 (0x11e)*
       :Timestamp: 0
       :Variable declarations
       :Macro implementations
\*=----------------------------------------------------------------------=*/
/*=----------------------------------------------------------------------=*\
   Use :Returns a JavaScript reference for a Flowcode component
       :
       :Parameters for macro SetText:
       :  text : MX_CHAR
\*=----------------------------------------------------------------------=*/
function FCD_052d1_TextBlock1__SetText(FCL_TEXT)
{
  const FC_THIS = '052d1_TextBlock1';
  document.getElementById(FC_THIS).innerHTML = FCL_TEXT;

}


/*=----------------------------------------------------------------------=*\
   Use :JSONDecoder1
       :GUID: 872dba99-b369-457e-b6f1-914a9f35ad19
       :Location: D:\Dev\Flowcode V10\Components\temprelease\WebJSONDecoder.fcpx
       :Version: 1.0 (0x11e)*
       :Timestamp: 0
       :Variable declarations
       :Macro implementations
\*=----------------------------------------------------------------------=*/
/*=----------------------------------------------------------------------=*\
   Use :Searches for a name in the JSON data. Returns the data index position. 
       :Returns -1 if the name was not found.
       :
       :Parameters for macro FindName:
       :  Name : Name of the data key to find
       :  SkipCount : Number of matches to skip before returning.
       :
       :Returns : MX_SINT16
\*=----------------------------------------------------------------------=*/
function FCD_08a81_JSONDecoder1__FindName(FCL_NAME, FCL_SKIPCOUNT)
{
  const FC_THIS = '08a81_JSONDecoder1';
  //Local variable definitions
  let FCL_IDX = 0;  // 
  let FCL_STR = "";  // 
  let FCL_LENGTH = 0;  // 
  let FCR_RETVAL = 0;  // 

  // .Return = -1
  FCR_RETVAL = -1;

  FCL_LENGTH = Object.keys(FCV_JSON_DATA).length;

  while ((FCL_SKIPCOUNT >= 0) && (FCL_IDX < FCL_LENGTH))
  {
    FCL_STR = FCD_08a81_JSONDecoder1__ReadName(FCL_IDX);

    if (FCI_COMPARE(FCL_STR, FCL_NAME, 0) == 0)
    {
      // .SkipCount = .SkipCount - 1
      FCL_SKIPCOUNT = FCL_SKIPCOUNT - 1;

      if (FCL_SKIPCOUNT < 0)
      {
        // .Return = .idx
        FCR_RETVAL = FCL_IDX;

      // } else {
      }

    // } else {
    }

    // .idx = .idx + 1
    FCL_IDX = FCL_IDX + 1;


  }

  return (FCR_RETVAL);

}

/*=----------------------------------------------------------------------=*\
   Use :Reads the data of a specific element as a string value
       :
       :Parameters for macro ReadDataAsString:
       :  Element : Index of the element to read
       :
       :Returns : MX_CHAR*
\*=----------------------------------------------------------------------=*/
function FCD_08a81_JSONDecoder1__ReadDataAsString(FCL_ELEMENT)
{
  const FC_THIS = '08a81_JSONDecoder1';
  //Local variable definitions
  FCR_RETVAL = Object.values(FCV_JSON_DATA)[FCL_ELEMENT];

  return (FCR_RETVAL);

}

/*=----------------------------------------------------------------------=*\
   Use :Reads the name of a specific element
       :
       :Parameters for macro ReadName:
       :  Element : The Index of the element to read
       :
       :Returns : MX_CHAR*
\*=----------------------------------------------------------------------=*/
function FCD_08a81_JSONDecoder1__ReadName(FCL_ELEMENT)
{
  const FC_THIS = '08a81_JSONDecoder1';
  //Local variable definitions
  FCR_RETVAL = Object.keys(FCV_JSON_DATA)[FCL_ELEMENT];

  return (FCR_RETVAL);

}

/*=----------------------------------------------------------------------=*\
   Use :Converts JSON formatted string to a JavaScript object.
       :Compatible with FindName, ReadName and ReadDataAs functions.
       :Returns the number of key/data pairs.
       :
       :Parameters for macro ParseJSON:
       :  sText : JSON string data to parse
       :
       :Returns : MX_UINT32
\*=----------------------------------------------------------------------=*/
function FCD_08a81_JSONDecoder1__ParseJSON(FCL_STEXT)
{
  const FC_THIS = '08a81_JSONDecoder1';
  //Local variable definitions
  let FCR_RETVAL = 0x0;  // 

  FCV_JSON_DATA = JSON.parse(FCL_STEXT);
  FCR_RETVAL = Object.keys(FCV_JSON_DATA).length;


  return (FCR_RETVAL);

}

/*=----------------------------------------------------------------------=*\
   Use :Reads the data of a specific element as a floating point value
       :
       :Parameters for macro ReadDataAsFloat:
       :  Element : Index of the element to read
       :
       :Returns : MX_FLOAT
\*=----------------------------------------------------------------------=*/
function FCD_08a81_JSONDecoder1__ReadDataAsFloat(FCL_ELEMENT)
{
  const FC_THIS = '08a81_JSONDecoder1';
  //Local variable definitions
  let FCR_RETVAL = 0.0;  // 

  FCR_RETVAL = Object.values(FCV_JSON_DATA)[FCL_ELEMENT];

  return (FCR_RETVAL);

}

/*=----------------------------------------------------------------------=*\
   Use :Reads the data of a specific element as a numeric value
       :
       :Parameters for macro ReadDataAsNumber:
       :  Element : Index of the element to read
       :
       :Returns : MX_UINT32
\*=----------------------------------------------------------------------=*/
function FCD_08a81_JSONDecoder1__ReadDataAsNumber(FCL_ELEMENT)
{
  const FC_THIS = '08a81_JSONDecoder1';
  //Local variable definitions
  let FCL_OBJ = {};  // 
  let FCR_RETVAL = 0x0;  // 

  FCR_RETVAL = Object.values(FCV_JSON_DATA)[FCL_ELEMENT];

  return (FCR_RETVAL);

}


/*=----------------------------------------------------------------------=*\
   Use :User Project
       :Variable declarations
       :Macro implementations
\*=----------------------------------------------------------------------=*/
let FCV_FALSE = false;  // 
let FCV_TRUE = true;  // 
let FCV_OUTPUT_STR = "";  // 
let FCV_DATACOUNT = 0;  // 
let FCV_DATAINDEX = 0;  // 
let FCV_TEMPERATURE = 0.0;  // 
let FCV_JS_STR = "";  // 
let FCV_HUMIDITY = 0.0;  // 


</script>

<!---------------------------------------------------------------------------
   Use :Main
---------------------------------------------------------------------------->
<!-- WEBEXP: customise the <main> function here-->
<script>
async function MyMainFunction()
{
	//WEBEXP: init code within <main> can be customised here.


  // Name: Populate string with some demo JSON encoded data, Type: Calculation:
  // Js_Str = "{\"temp\":22.4,\"hum\":60}"
  FCV_JS_STR = "{\"temp\":22.4,\"hum\":60}";

  // Name: Parse JSON data - Return number of data fields discovered, Type: Component Macro: DataCount=JSONDecoder1::ParseJSON(Js_Str)
  FCV_DATACOUNT = FCD_08a81_JSONDecoder1__ParseJSON(FCV_JS_STR);

  // Name: Look for temperature field, Type: Component Macro: DataIndex=JSONDecoder1::FindName("temp", 0)
  FCV_DATAINDEX = FCD_08a81_JSONDecoder1__FindName("temp", 0);

  // Name: If data index found?, Type: Decision: DataIndex >= 0?
  if (FCV_DATAINDEX >= 0)
  {
    // Name: Component Macro, Type: Component Macro: temperature=JSONDecoder1::ReadDataAsFloat(DataIndex)
    FCV_TEMPERATURE = FCD_08a81_JSONDecoder1__ReadDataAsFloat(FCV_DATAINDEX);

  // } else {
  }

  // Name: Look for humidity field, Type: Component Macro: DataIndex=JSONDecoder1::FindName("hum", 0)
  FCV_DATAINDEX = FCD_08a81_JSONDecoder1__FindName("hum", 0);

  // Name: If data index found?, Type: Decision: DataIndex >= 0?
  if (FCV_DATAINDEX >= 0)
  {
    // Name: Component Macro, Type: Component Macro: humidity=JSONDecoder1::ReadDataAsFloat(DataIndex)
    FCV_HUMIDITY = FCD_08a81_JSONDecoder1__ReadDataAsFloat(FCV_DATAINDEX);

  // } else {
  }

  //Comment:
  //Data parsed - now print to text box

  // Name: Calculation, Type: Calculation:
  // Output_Str = "Temperature: " + FloatToString$(temperature,3) + "<br />"
  // Output_Str = Output_Str + "Humidity: " + FloatToString$(humidity,3) + "<br />"
  FCV_OUTPUT_STR = "Temperature: " + FCI_FLOAT2STR(FCV_TEMPERATURE, 3) + "<br />";
  FCV_OUTPUT_STR = FCV_OUTPUT_STR + "Humidity: " + FCI_FLOAT2STR(FCV_HUMIDITY, 3) + "<br />";

  // Name: Component Macro, Type: Component Macro: TextBlock1::SetText(Output_Str)
  FCD_052d1_TextBlock1__SetText(FCV_OUTPUT_STR);

}
</script>



<!---------------------------------------------------------------------------
   Use :Interrupt
---------------------------------------------------------------------------->

<!-- WEBEXP: put any code at the bottom of the file here-->
<script>
  function StartupCheck(obj)
  {
    let i = MxDelayedObjects.indexOf(obj);
    MxDelayedObjects.splice(i,1);
    if (MxDelayedObjects.length == 0)
    {
      MyMainFunction();
    }
  }

  //Check delay-start objects and start immediately if there are none
  if (MxDelayedObjects.length == 0)
  {
    MyMainFunction();
  }
</script>







</body>
</html>
